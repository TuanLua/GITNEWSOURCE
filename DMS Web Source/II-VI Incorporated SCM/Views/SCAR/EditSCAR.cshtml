@model II_VI_Incorporated_SCM.Models.SCAR.SCARInfoViewModel

@{
    ViewBag.Title = "SCAR";
}

<style>
    .dropdown {
        position: relative;
        display: inline-block;
    }

    .dropdown-content {
        display: none;
        position: absolute;
        background-color: #f9f9f9;
        min-width: 160px;
        box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.2);
        padding: 12px 16px;
        z-index: 1;
    }

    .dropdown:hover .dropdown-content {
        display: block;
    }

    .email:hover {
        background-color: cornflowerblue;
    }
</style>

@using (Html.BeginForm("SaveEditSCAR", "SCAR", FormMethod.Post, new { @class = "form-horizontal", role = "form", @enctype = "multipart/form-data", @id = "editSCARForm" }))
{

    <div class="container">
    </div>

    <button type="button" class="btn btn-success" onclick="saveSCAR()">Save</button>
    <button type="button" class="btn btn-danger" onclick="closeSCAR()">Close</button>
    <button type="button" class="btn btn-success" onclick="voidSCAR()" style="float:right">Void</button>
    <div align="center"><h2><strong>SUPPLIER CORRECTIVE ACTION REQUEST (SCAR)</strong></h2></div>
    <div>
        <table class="table table-striped table-bordered table-hover" border="1">
            <tr>
                <td colspan="2">
                    &nbsp;
                </td>
                <td>Form: 005-0206 Rev </td>
            </tr>
            <tr>
                <td>
                    <div class="row top-buffer">
                        <label class="col-md-2 control-label">Supplier:</label>
                        <div class="col-md-10">
                            @Html.TextBox("VEN_NAM", (string)ViewBag.SupplierInfo.VEN_NAM, new { @class = "form-control", @readonly = "readonly" })
                            @Html.Hidden("VERSION", Model.VERSION)
                        </div>
                    </div>

                    <div class="row top-buffer">
                        <label class="col-md-2 control-label">Address:</label>
                        <div class="col-md-10">
                            @Html.TextBox("ADDRESS", (string)ViewBag.SupplierInfo.ADDRESS, new { @class = "form-control", @readonly = "readonly" })
                        </div>
                    </div>

                    <div class="row top-buffer">
                        <label class="col-md-2 control-label">Contact:</label>
                        <div class="col-md-10">
                            @Html.TextBox("CONTACT", (string)ViewBag.SupplierInfo.CONTACT, new { @class = "form-control", @readonly = "readonly" })
                        </div>
                    </div>

                    <div class="row top-buffer">
                        <label class="col-md-2 control-label">Email:</label>
                        <div class="col-md-10">
                            @Html.TextBox("EMAIL", (string)ViewBag.SupplierInfo.EMAIL, new { @class = "form-control", @readonly = "readonly" })
                        </div>
                    </div>

                    <div class="row top-buffer">
                        <label class="col-md-2 control-label">Tel:</label>
                        <div class="col-md-10">
                            @Html.TextBox("TEL", (string)ViewBag.SupplierInfo.TEL, new { @class = "form-control", @readonly = "readonly" })
                        </div>
                    </div>

                    <div class="row top-buffer">
                        <label class="col-md-2 control-label">Fax:</label>
                        <div class="col-md-10">
                            @Html.TextBox("FAX", (string)ViewBag.SupplierInfo.FAX, new { @class = "form-control", @readonly = "readonly" })
                        </div>
                    </div>
                </td>
                <td>
                    <div class="row top-buffer">
                        <label class="col-md-4 control-label">SCAR #:</label>
                        <div class="col-md-8">
                            @Html.TextBox("SCAR_ID", Model.SCAR_ID, new { @class = "form-control", @readonly = "readonly" })
                        </div>
                    </div>

                    <div class="row top-buffer">
                        <label class="col-md-4 control-label">Noncomforming Qty:</label>
                        <div class="col-md-8">
                            @Html.TextBox("NON_QTY", Model.NON_QTY, new { @class = "form-control", @readonly = "readonly" })
                            <span id="Err_NonConfQty" class="help-block text-danger"></span>
                        </div>
                    </div>

                    <div class="row top-buffer">
                        <label class="col-md-4 control-label">II-VI Marlow NCR #:</label>
                        <div class="col-md-8">
                            @Html.TextBox("NCR_NUMBER", Model.NCR_NUMBER, new { @class = "form-control digital-led", @readonly = "readonly" })
                        </div>
                    </div>

                    <div class="row top-buffer">
                        <label class="col-md-4 control-label">RMA#:</label>
                        <div class="col-md-8">
                            @Html.TextBox("RMA", Model.RMA, new { @class = "form-control", @readonly = "readonly" })
                            <span id="Err_RMA" class="help-block text-danger"></span>
                        </div>
                    </div>
                </td>
                <td>
                    <div class="row top-buffer">
                        <label class="col-md-5 control-label">Requested By:</label>
                        <div class="col-md-7">
                        </div>
                    </div>

                    <div class="row top-buffer">
                        <label class="col-md-3 control-label">Buyer:</label>
                        <div class="col-md-9">
                            @Html.TextBox("BUYER", Model.BUYER, new { @class = "form-control", @readonly = "readonly" })
                        </div>
                    </div>

                    <div class="row top-buffer">
                        <label class="col-md-3 control-label">Quality:</label>
                        <div class="col-md-9">
                            @Html.TextBox("QUALITY", Model.QUALITY, new { @class = "form-control", @readonly = "readonly" })
                        </div>
                    </div>

                    <div class="row top-buffer">
                        <div class="col-md-12">
                            <table class="table table-striped table-bordered table-hover">
                                <tr style="background-color:gray">
                                    <td colspan="2" align="center">
                                        For II-VI Marlow Use Only:
                                    </td>
                                </tr>
                                <tr style="background-color:gray">
                                    <td>
                                        VN SCAR #:
                                    </td>
                                    <td>@Html.TextBox("VN_SCAR", Model.VN_SCAR, new { @class = "form-control", @readonly = "readonly" })</td>
                                </tr>
                                <tr style="background-color:gray">
                                    <td>
                                        VN NCR #:
                                    </td>
                                    <td>@Html.TextBox("VN_NCR", Model.VN_NCR, new { @class = "form-control", @readonly = "readonly" })</td>
                                </tr>
                            </table>
                        </div>
                    </div>
                </td>
            </tr>
            <tr>
                <td colspan="2">
                    Purchase Order Number:	@Html.TextBox("PO_NUMBER", Model.PO_NUMBER, new { @class = "form-control", @readonly = "readonly" })
                </td>
                <td></td>
            </tr>
            <tr>
                <td colspan="2">
                    II-VI Marlow Part Number: @Html.TextBox("MI_PART_NO", Model.MI_PART_NO, new { @class = "form-control", @readonly = "readonly" })
                </td>
                <td></td>
            </tr>
            <tr>
                <td colspan="2"><b>CUSTOMER CONCERN:</b></td>
                <td>
                    <div class="row top-buffer">
                        <label class="col-md-1 control-label">DATE:</label>
                        <div class="col-md-11">
                            @Html.TextBox("DATEPROBLEM", Model.DATEPROBLEM.ToString("MM/dd/yyyy"), new { @class = "form-control", @readonly = "readonly" })
                            @*<span class="help-block text-danger requiredBox"></span>*@
                        </div>
                    </div>
                </td>
            </tr>
            <tr>
                <td colspan="2">
                    Recurring Problem?
                    <select id="recurring" name="RECURING_PROBLEM">
                        <option value="Yes">Yes</option>
                        <option value="No">No</option>
                    </select>
                </td>
                <td></td>
            </tr>
            <tr>
                <td colspan="3">
                    @Html.TextArea("PROBLEM", Model.PROBLEM, new { @class = "form-control", @rows = 5 })
                    <span class="help-block text-danger requiredBox"></span>
                </td>
            </tr>
            <tr>
                <td colspan="3">
                    The above material was found to be non-compliant with the II-VI Marlow specification or purchase order.  Please identify the cause of the defect and the corrective and preventive action taken.  A response should be returned by the given date (below).  Should you require additional time, please contact the II-VI Marlow Supplier Quality Department prior to the due date to request an extension.  (Attach objective evidence as proof of actions taken.)

                </td>

            </tr>
            <tr>
                <td>
                    Please Respond By:
                </td>
                <td>
                    @*@Html.TextBox("DATERESPOND", Model.DATERESPOND.ToString("yyyy-MM-dd"), new { @type = "date", @class = "form-control", @style = "background-color:yellow" })
                    <span class="help-block text-danger requiredBox"></span>*@

                    @*SIL*@
                    <div class="input-group date" data-provide="datepicker">
                        @Html.TextBox("DATERESPOND", "", new { @class = "form-control", @style = "background-color:yellow" })
                        <div class="input-group-addon">
                            <span class="glyphicon glyphicon-th"></span>
                        </div>
                    </div>
                    <span class="help-block text-danger requiredBox"></span>
                </td>
                <td></td>
            </tr>
        </table>
    </div>
}

<script>
    var $editSCARForm = $('#editSCARForm');
    var homeUrl = '@Url.Action("Index", "SCAR")'
    var status = '@Request.Params["STATUS"]';
    var SCARID = '@Request.Params["SCARID"]';
   // $("#recurring").val("@Model.RECURING_PROBLEM");

    $("#recurring option[value='@Model.RECURING_PROBLEM']").attr("selected", true);
    $(document).ready(function () {
        //disabling past date from datepicker
        var nowDate = new Date();
        var today = new Date(nowDate.getFullYear(), nowDate.getMonth(), nowDate.getDate(), 0, 0, 0, 0);
        //initializing datepicker
        $('.date').datepicker({ startDate: today, autoclose: true });

        //$("#DATERESPOND").datepicker();
        //$("#DATEPROBLEM").datepicker();
        if ($('[type="date"]').prop('type') != 'date') {
            $('[type="date"]').datepicker();
        }
    });

    function saveSCAR() {
        if (/*$('#DATEPROBLEM').val() == "" ||*/ $('#PROBLEM').val() == "" || $('#DATERESPOND').val() == "") {
            $('.requiredBox').html("This field is required!")
        } else {
            $('.requiredBox').html("")
            $editSCARForm.submit()
        }
    }

    $editSCARForm.submit(function (e) {
        $.blockUI();
        var data = new FormData(this);
        var $fromObj = $(this);
        var urlAction = $fromObj.attr('action');
        $.ajax({
            url: urlAction,
            type: 'POST',
            dataType: "Json",
            contentType: false,
            cache: false,
            processData: false,
            data: data,
            fail: function () {
                bootbox.alert('Please contact to Administrator!');
            }
        }).always(function () {
            $.unblockUI();
        }).success(function (result) {
            if (result.success) {
                bootbox.alert('Edit SCAR successfully',
                    function (result1) {
                        if (status == "Accepted by Supplier") {
                            window.open("../Content/FolderSCAR/" + result.path)
                            window.location.href = homeUrl;
                        }
                        if (status == "Sent") {
                            window.open("../Content/FolderSCAR/" + result.path)
                            window.location.href = '@Url.Action("SentSCAR", "SCAR")' + "?SCARID=" + SCARID + "&VERSION=" + $('#VERSION').val();
                        }
                    });
            } else {
                bootbox.alert(result.alert);
            }
        });
        e.preventDefault();
    });

    function closeSCAR() {
        window.location.href = homeUrl;
    }

    function voidSCAR() {
        bootbox.confirm({
            message: "Are you sure with this action?",
            buttons: {
                confirm: {
                    label: 'Yes',
                    className: 'btn-success'
                },
                cancel: {
                    label: 'No',
                    className: 'btn-danger'
                }
            },
            callback: function (result) {
                if (result) {
                    $.blockUI();
                    $.post("@Url.Action("UpdateStatusSCAR", "SCAR")", { status: "Void", SCARID: SCARID }, function (result) {
                        if (result.success) {
                            if ($('#Attach').is(":checked")) {

                            } else {
                                window.location = '@Url.Action("Index", "SCAR")';
                            }
                        } else {
                            bootbox.alert('Action failed. Please contact admin');
                        }
                    }).fail(function () {
                        bootbox.alert('Action failed. Please contact admin');
                    }).always(function () {
                        $.unblockUI();
                    });
                }
            }
        });
    }
</script>